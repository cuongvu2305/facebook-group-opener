<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Facebook Group Auto Opener</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            color: #1877f2;
            margin-bottom: 30px;
        }
        
        .group-section {
            display: inline-block;
            margin: 15px;
            vertical-align: top;
        }
        
        .dropdown-header {
            width: 120px;
            height: 40px;
            border: 2px solid #333;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            position: relative;
        }
        
        .dropdown-header::after {
            content: "‚ñº";
            position: absolute;
            right: 10px;
            font-size: 12px;
        }
        
        .dropdown-content {
            width: 120px;
            border: 2px solid #333;
            border-top: none;
            background: white;
            min-height: 200px;
            padding: 10px;
            box-sizing: border-box;
        }
        
        .group-item {
            padding: 8px 5px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .group-item:hover {
            background-color: #e3f2fd;
        }
        
        .group-item:last-child {
            border-bottom: none;
        }
        
        .open-button {
            width: 200px;
            height: 50px;
            background-color: #1877f2;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin: 30px auto;
            display: block;
            transition: background-color 0.2s;
        }
        
        .open-button:hover {
            background-color: #166fe5;
        }
        
        .open-button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        
        .delay-setting {
            margin: 15px 0;
        }
        
        label {
            display: inline-block;
            width: 150px;
            text-align: right;
            margin-right: 10px;
        }
        
        input[type="number"], select {
            width: 80px;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        select {
            width: 90px;
        }
        
        .status {
            text-align: center;
            margin: 15px 0;
            font-weight: bold;
            min-height: 20px;
        }
        
        .add-group {
            background-color: #42b883;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 5px;
        }
        
        .remove-group {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
            font-size: 12px;
        }
        
        .group-input {
            width: 300px;
            padding: 8px;
            margin: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .add-section {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîó Facebook Group Auto Opener</h1>
        
        <div class="add-section">
            <h3>‚ûï Qu·∫£n l√Ω Links:</h3>
            <div style="margin-bottom: 10px;">
                <input type="text" id="linkName" placeholder="T√™n group" class="group-input" style="width: 200px;">
                <input type="url" id="linkUrl" placeholder="https://facebook.com/groups/..." class="group-input" style="width: 300px;">
                <button onclick="addNewLink()" class="add-group">‚ûï Th√™m Link</button>
            </div>
            <div>
                <select id="linkToDelete" class="group-input" style="width: 250px;">
                    <option value="">-- Ch·ªçn link ƒë·ªÉ x√≥a --</option>
                </select>
                <button onclick="deleteSelectedLink()" class="remove-group" style="margin-left: 10px; padding: 8px 15px;">üóëÔ∏è X√≥a Link</button>
                <button onclick="clearAllLinks()" class="remove-group" style="margin-left: 5px; padding: 8px 15px;">üßπ X√≥a t·∫•t c·∫£</button>
            </div>
            <div style="text-align: center; margin-top: 10px;">
                <small id="saveStatus" style="font-weight: bold;"></small>
                <br>
                <small style="color: #666;">üíæ D·ªØ li·ªáu t·ª± ƒë·ªông l∆∞u v√†o tr√¨nh duy·ªát</small>
            </div>
        </div>
        
        <div class="group-section" style="width: 100%; max-width: 400px; margin: 20px auto;">
            <div class="dropdown-header" onclick="toggleDropdown(0)" style="width: 100%;">
                Danh s√°ch Links
            </div>
            <div class="dropdown-content" id="dropdown-0" style="width: 100%; max-height: 300px; overflow-y: auto;">
                <!-- Links s·∫Ω ƒë∆∞·ª£c render ·ªü ƒë√¢y -->
            </div>
        </div>
        
        <div class="controls">
            <div class="delay-setting">
                <label for="delay">ƒê·ªô tr·ªÖ gi·ªØa c√°c tab (gi√¢y):</label>
                <input type="number" id="delay" value="2" min="1" max="10">
            </div>
            
            <div class="delay-setting">
                <label for="fromLink">M·ªü t·ª´ link s·ªë:</label>
                <select id="fromLink">
                    <option value="1">1</option>
                </select>
                
                <label for="toLink" style="margin-left: 20px;">ƒê·∫øn link s·ªë:</label>
                <select id="toLink">
                    <option value="1">1</option>
                </select>
            </div>
            
            <button onclick="openSelectedGroups()" class="open-button" id="openBtn">
                üöÄ M·ªû T·∫§T C·∫¢ LINKS
            </button>
            
            <div style="text-align: center; margin: 15px 0;">
                <button onclick="testRange()" style="background: #6c757d; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; margin: 0 5px;">
                    üîç Test Range
                </button>
                <button onclick="testPopup()" style="background: #fd7e14; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; margin: 0 5px;">
                    ü™ü Test Popup
                </button>
            </div>
            
            <div class="status" id="status"></div>
        </div>
    </div>

    <script>
        // D·ªØ li·ªáu ƒë∆°n gi·∫£n - ch·ªâ m·ªôt danh s√°ch links
        let linksData = [];

        // Load data t·ª´ localStorage khi kh·ªüi ƒë·ªông
        function loadFromStorage() {
            try {
                const saved = localStorage.getItem('fbGroupLinks');
                if (saved) {
                    linksData = JSON.parse(saved);
                    console.log('‚úÖ Loaded', linksData.length, 'links from localStorage');
                } else {
                    // Default demo data n·∫øu ch∆∞a c√≥
                    linksData = [
                        { name: "AIFIRST", url: "https://www.facebook.com/groups/aifirst.vn" },
                        { name: "AI VIET NAM", url: "https://www.facebook.com/groups/aivietnam.edu.vn" },
                        { name: "AI-First Company x AI First Growth Platform", url: "https://www.facebook.com/groups/ai.transform" },
                        { name: "Ch√©m Gi√≥ V·ªÅ AI - C·ªông ƒê·ªìng Chia S·∫ª & K·∫øt N·ªëi", url: "https://www.facebook.com/groups/1255173554614475" },
                        { name: "AI FOR VIETNAM EDUCATION", url: "https://www.facebook.com/groups/1043393823642926" }
                    ];
                    saveToStorage(); // L∆∞u demo data
                }
            } catch (error) {
                console.error('‚ùå Error loading from localStorage:', error);
                linksData = [];
            }
        }

        // L∆∞u data v√†o localStorage
        function saveToStorage() {
            try {
                localStorage.setItem('fbGroupLinks', JSON.stringify(linksData));
                localStorage.setItem('fbGroupLinks_backup', JSON.stringify({
                    data: linksData,
                    timestamp: new Date().toISOString(),
                    count: linksData.length
                }));
                console.log('üíæ Saved', linksData.length, 'links to localStorage');
                
                // Update status
                updateSaveStatus('‚úÖ ƒê√£ l∆∞u t·ª± ƒë·ªông');
            } catch (error) {
                console.error('‚ùå Error saving to localStorage:', error);
                updateSaveStatus('‚ùå L·ªói l∆∞u d·ªØ li·ªáu');
            }
        }

        // Update save status display
        function updateSaveStatus(message) {
            const statusEl = document.getElementById('saveStatus');
            if (statusEl) {
                statusEl.textContent = message;
                statusEl.style.color = message.includes('‚úÖ') ? '#28a745' : '#dc3545';
                
                // Clear message after 3 seconds
                setTimeout(() => {
                    statusEl.textContent = '';
                }, 3000);
            }
        }

        function renderLinks() {
            const container = document.getElementById('dropdown-0');
            container.innerHTML = '';
            
            linksData.forEach((link, index) => {
                const linkDiv = document.createElement('div');
                linkDiv.className = 'group-item';
                linkDiv.onclick = () => openSingleLink(link.url);
                linkDiv.innerHTML = `${index + 1}. ${link.name}`;
                container.appendChild(linkDiv);
            });
            
            updateRangeSelectors();
            updateDeleteLinkSelector();
        }

        function updateDeleteLinkSelector() {
            const selector = document.getElementById('linkToDelete');
            selector.innerHTML = '<option value="">-- Ch·ªçn link ƒë·ªÉ x√≥a --</option>';
            
            linksData.forEach((link, index) => {
                selector.innerHTML += `<option value="${index}">${index + 1}. ${link.name}</option>`;
            });
        }

        function updateRangeSelectors() {
            const totalLinks = linksData.length;
            
            const fromSelect = document.getElementById('fromLink');
            const toSelect = document.getElementById('toLink');
            
            // L∆∞u gi√° tr·ªã hi·ªán t·∫°i
            const currentFrom = fromSelect.value;
            const currentTo = toSelect.value;
            
            // Clear v√† rebuild options
            fromSelect.innerHTML = '';
            toSelect.innerHTML = '';
            
            // T·∫°o options t·ª´ 1 ƒë·∫øn totalLinks
            for (let i = 1; i <= totalLinks; i++) {
                fromSelect.innerHTML += `<option value="${i}">${i}</option>`;
                toSelect.innerHTML += `<option value="${i}">${i}</option>`;
            }
            
            // Kh√¥i ph·ª•c gi√° tr·ªã n·∫øu c√≤n h·ª£p l·ªá
            if (currentFrom && currentFrom <= totalLinks && currentFrom >= 1) {
                fromSelect.value = currentFrom;
            } else {
                fromSelect.value = 1; // Default to 1
            }
            
            if (currentTo && currentTo <= totalLinks && currentTo >= 1) {
                toSelect.value = currentTo;
            } else {
                toSelect.value = totalLinks || 1; // Default to max or 1
            }
            
            // Debug log
            console.log('Updated range selectors:', {
                totalLinks: totalLinks,
                fromValue: fromSelect.value,
                toValue: toSelect.value
            });
        }

        function toggleDropdown(index) {
            const dropdown = document.getElementById(`dropdown-${index}`);
            const isVisible = dropdown.style.display !== 'none';
            dropdown.style.display = isVisible ? 'none' : 'block';
        }

        function clearAllLinks() {
            if (confirm('‚ö†Ô∏è B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a T·∫§T C·∫¢ links? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!')) {
                linksData = [];
                renderLinks();
                alert('‚úÖ ƒê√£ x√≥a t·∫•t c·∫£ links!');
            }
        }

        function addNewLink() {
            const name = document.getElementById('linkName').value.trim();
            const url = document.getElementById('linkUrl').value.trim();
            
            if (!name || !url) {
                alert('‚ö†Ô∏è Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß t√™n v√† URL!');
                return;
            }
            
            // Validate URL
            try {
                new URL(url);
            } catch (e) {
                alert('‚ö†Ô∏è URL kh√¥ng h·ª£p l·ªá! Vui l√≤ng ki·ªÉm tra l·∫°i.');
                return;
            }
            
            linksData.push({ name, url });
            
            // Clear inputs
            document.getElementById('linkName').value = '';
            document.getElementById('linkUrl').value = '';
            
            renderLinks();
            alert(`‚úÖ ƒê√£ th√™m "${name}" v√†o danh s√°ch!`);
        }

        function deleteSelectedLink() {
            const selector = document.getElementById('linkToDelete');
            const index = parseInt(selector.value);
            
            if (isNaN(index)) {
                alert('Vui l√≤ng ch·ªçn link ƒë·ªÉ x√≥a!');
                return;
            }
            
            if (confirm(`B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a link "${linksData[index].name}"?`)) {
                linksData.splice(index, 1);
                renderLinks();
            }
        }

        function openSingleLink(url) {
            window.open(url, '_blank');
        }

        async function openSelectedGroups() {
            const fromLink = parseInt(document.getElementById('fromLink').value);
            const toLink = parseInt(document.getElementById('toLink').value);
            const delay = parseInt(document.getElementById('delay').value) * 1000;
            const openBtn = document.getElementById('openBtn');
            const status = document.getElementById('status');
            
            console.log('=== DEBUG START ===');
            console.log('fromLink:', fromLink, 'toLink:', toLink);
            console.log('linksData:', linksData);
            
            if (fromLink > toLink) {
                alert('‚ö†Ô∏è Link b·∫Øt ƒë·∫ßu kh√¥ng th·ªÉ l·ªõn h∆°n link k·∫øt th√∫c!');
                return;
            }
            
            if (linksData.length === 0) {
                alert('‚ö†Ô∏è Kh√¥ng c√≥ links ƒë·ªÉ m·ªü!');
                return;
            }
            
            openBtn.disabled = true;
            openBtn.textContent = '‚è≥ ƒêang m·ªü...';
            
            // T·∫°o array c√°c links c·∫ßn m·ªü
            const selectedLinks = [];
            for (let i = fromLink - 1; i < toLink; i++) {
                if (linksData[i]) {
                    selectedLinks.push(linksData[i]);
                }
            }
            
            console.log('Selected links:', selectedLinks);
            
            if (selectedLinks.length === 0) {
                alert('‚ö†Ô∏è Kh√¥ng c√≥ links trong kho·∫£ng ƒë√£ ch·ªçn!');
                openBtn.disabled = false;
                openBtn.textContent = 'üöÄ M·ªû T·∫§T C·∫¢ LINKS';
                return;
            }
            
            // OPTION 1: M·ªü t·∫•t c·∫£ c√πng l√∫c (kh√¥ng delay)
            if (delay === 0 || selectedLinks.length <= 3) {
                console.log('Opening all links at once...');
                selectedLinks.forEach((link, index) => {
                    const linkNumber = fromLink + index;
                    console.log(`Opening link ${linkNumber}: ${link.name} ‚Üí ${link.url}`);
                    
                    // S·ª≠ d·ª•ng setTimeout nh·ªè ƒë·ªÉ tr√°nh browser block
                    setTimeout(() => {
                        window.open(link.url, '_blank');
                    }, index * 100); // 100ms apart
                });
                
                status.textContent = `‚úÖ ƒê√£ m·ªü ${selectedLinks.length} links c√πng l√∫c!`;
                status.style.color = '#28a745';
            } 
            // OPTION 2: M·ªü t·ª´ng c√°i v·ªõi delay
            else {
                console.log('Opening links with delay...');
                for (let i = 0; i < selectedLinks.length; i++) {
                    const link = selectedLinks[i];
                    const currentLinkNumber = fromLink + i;
                    
                    status.textContent = `üöÄ ƒêang m·ªü link ${currentLinkNumber}/${toLink}: ${link.name}`;
                    status.style.color = '#1877f2';
                    
                    console.log(`Opening link ${currentLinkNumber}: ${link.name} ‚Üí ${link.url}`);
                    
                    // M·ªü link
                    const newWindow = window.open(link.url, '_blank');
                    
                    // Check if popup was blocked
                    if (!newWindow || newWindow.closed || typeof newWindow.closed == 'undefined') {
                        console.warn('Popup blocked for:', link.name);
                        alert(`‚ö†Ô∏è Popup b·ªã ch·∫∑n cho link: ${link.name}\nVui l√≤ng cho ph√©p popup v√† th·ª≠ l·∫°i!`);
                        break;
                    }
                    
                    // Delay tr∆∞·ªõc link ti·∫øp theo
                    if (i < selectedLinks.length - 1) {
                        console.log(`‚è≥ Waiting ${delay}ms...`);
                        await new Promise(resolve => setTimeout(resolve, delay));
                    }
                }
                
                status.textContent = `‚úÖ Ho√†n th√†nh! ƒê√£ m·ªü ${selectedLinks.length} links.`;
                status.style.color = '#28a745';
            }
            
            openBtn.disabled = false;
            openBtn.textContent = 'üöÄ M·ªû T·∫§T C·∫¢ LINKS';
            console.log('=== DEBUG END ===');
        }

        function testPopup() {
            console.log('Testing popup functionality...');
            
            // Test m·ªü 3 tabs c√πng l√∫c
            const testUrls = [
                'https://www.google.com',
                'https://www.facebook.com', 
                'https://www.youtube.com'
            ];
            
            let successCount = 0;
            let blockedCount = 0;
            
            testUrls.forEach((url, index) => {
                setTimeout(() => {
                    const newWindow = window.open(url, '_blank');
                    
                    if (!newWindow || newWindow.closed || typeof newWindow.closed == 'undefined') {
                        blockedCount++;
                        console.warn(`Popup ${index + 1} blocked:`, url);
                    } else {
                        successCount++;
                        console.log(`Popup ${index + 1} opened:`, url);
                        
                        // ƒê√≥ng test window sau 2 gi√¢y
                        setTimeout(() => {
                            try {
                                newWindow.close();
                            } catch(e) {
                                console.log('Could not close test window (normal if user navigated)');
                            }
                        }, 2000);
                    }
                    
                    // Show result after last test
                    if (index === testUrls.length - 1) {
                        setTimeout(() => {
                            alert(`Test Popup Results:\n‚úÖ Opened: ${successCount}\n‚ùå Blocked: ${blockedCount}\n\n${blockedCount > 0 ? 'Please allow popups for this site!' : 'Popup working fine!'}`);
                        }, 500);
                    }
                }, index * 200);
            });
        }

        function testRange() {
            const fromLink = parseInt(document.getElementById('fromLink').value);
            const toLink = parseInt(document.getElementById('toLink').value);
            
            console.log('=== TEST RANGE ===');
            console.log('From:', fromLink, 'To:', toLink);
            console.log('Total links:', linksData.length);
            console.log('Links:', linksData.map((link, i) => `${i+1}. ${link.name}`));
            
            // Test selection
            const selectedLinks = [];
            for (let i = fromLink - 1; i < toLink; i++) {
                if (linksData[i]) {
                    selectedLinks.push({
                        index: i + 1,
                        name: linksData[i].name,
                        url: linksData[i].url
                    });
                }
            }
            
            console.log('Selected links:');
            selectedLinks.forEach(link => {
                console.log(`  ${link.index}. ${link.name} ‚Üí ${link.url}`);
            });
            
            alert(`Debug Info:\n- T·ª´ link ${fromLink} ƒë·∫øn ${toLink}\n- T·ªïng ${linksData.length} links\n- S·∫Ω m·ªü ${selectedLinks.length} links\n\nXem Console (F12) ƒë·ªÉ detail!`);
        }

        // Kh·ªüi t·∫°o giao di·ªán
        renderLinks();
    </script>
</body>
</html>
